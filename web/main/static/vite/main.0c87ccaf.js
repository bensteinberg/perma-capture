var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,n)=>{for(var o in n||(n={}))t.call(n,o)&&r(e,o,n[o]);if(a)for(var o of a(n))s.call(n,o)&&r(e,o,n[o]);return e};import{c as o,p as i,a as l,r as d,o as c,b as u,d as p,t as h,F as m,e as g,w as b,f,g as w,h as y,i as v,j as k,k as _,l as C,m as T,n as L,v as x,q as A,s as U,u as S,x as P,y as E,z as j}from"./vendor.99cdc380.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const s=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,n)=>{const o=new URL(e,s);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const i=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){n(new Error(`Failed to import: ${e}`)),r(l)},onload(){a(self[t].moduleMap[o]),r(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/static/vite/");const{mapState:I,mapActions:D}=o("user");var F={computed:I(["first_name","is_authenticated","is_staff"]),methods:n(n({},D(["logout"])),{doLogout(e){return this.logout(e).then((()=>this.$router.push({name:"logout"})))}})};const R=f();i("data-v-8d91372a");const z={key:0,class:"dropdown"},W={class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdown-menu-nav","data-bs-toggle":"dropdown","aria-expanded":"false"},H={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"dropdown-menu-nav"},M=w("Dashboard"),$=w("My Account"),B=w("User Guide"),O=p("li",null,[p("hr",{class:"dropdown-divider"})],-1),q=p("li",null,[p("span",{class:"h6 dropdown-header"},"Admin Only")],-1),V=p("li",null,[p("a",{class:"dropdown-item",href:"/admin/"},"Django Admin")],-1),N=p("li",null,[p("hr",{class:"dropdown-divider"})],-1),Z=p("button",{type:"submit",class:"dropdown-item"},"Log out",-1),G={key:1,class:"navbar-nav"},K={class:"nav-item"},X=w("Sign up"),Y={class:"nav-item"},J=w("User Guide"),Q={class:"nav-item"},ee=w("Log in");l();const te=R(((e,t,a,s,r,n)=>{const o=d("router-link");return e.is_authenticated?(c(),u("div",z,[p("button",W,h(e.first_name),1),p("ul",H,[p("li",null,[p(o,{to:{name:"root"},class:"dropdown-item"},{default:R((()=>[M])),_:1})]),p("li",null,[p(o,{to:{name:"account"},class:"dropdown-item"},{default:R((()=>[$])),_:1})]),p("li",null,[p(o,{to:{name:"docs"},class:"dropdown-item"},{default:R((()=>[B])),_:1})]),e.is_staff?(c(),u(m,{key:0},[O,q,V],64)):g("",!0),N,p("li",null,[p("form",{onSubmit:t[1]||(t[1]=b(((...e)=>n.doLogout&&n.doLogout(...e)),["prevent"]))},[Z],32)])])])):(c(),u("ul",G,[p("li",K,[p(o,{to:{name:"sign_up"},class:"nav-link"},{default:R((()=>[X])),_:1})]),p("li",Y,[p(o,{to:{name:"docs"},class:"nav-link"},{default:R((()=>[J])),_:1})]),p("li",Q,[p(o,{to:{name:"login"},class:"nav-link"},{default:R((()=>[ee])),_:1})])]))}));F.render=te,F.__scopeId="data-v-8d91372a";o("globals");const ae={components:{TheMainNav:F}},se={class:"navbar navbar-expand-lg"},re={class:"container-fluid"},ne=p("img",{alt:"Perma logo",title:"Perma logo",src:"/static/vite/perma-logo.6b161a6e.svg"},null,-1),oe=w(" Perma Captures ");ae.render=function(e,t,a,s,r,n){const o=d("router-link"),i=d("TheMainNav");return c(),u("nav",se,[p("div",re,[p(o,{to:{name:"root"},class:"navbar-brand"},{default:y((()=>[ne,oe])),_:1}),p(i)])])};const ie={name:"Footer"},le={class:"page-footer"},de=v('<div><div class="attribution">Perma Captures is a project of the Harvard Law School <a href="https://lil.law.harvard.edu">Library Innovation Lab</a>.</div><div class="copyright">©2021 The President and Fellows of Harvard University.</div><a class="a11y-policy" href="https://accessibility.huit.harvard.edu/digital-accessibility-policy"><span aria-hidden="true">♿</span><span class="visually-hidden">Accessibility policy</span></a></div>',1);ie.render=function(e,t,a,s,r,n){return c(),u("footer",le,[de])};var ce=k({name:"App",components:{TheNavbar:ae,TheFooter:ie}});ce.render=function(e,t,a,s,r,n){const o=d("TheNavbar"),i=d("router-view"),l=d("TheFooter");return c(),u(m,null,[p(o),p("main",null,[p(i)]),p(l)],64)};var ue={namespaced:!0,state:n({},store_bootstrap.globals),getters:{},actions:{},mutations:{}};function pe(e=""){return e.split("_").map((e=>e.slice(0,1).toUpperCase()+e.slice(1))).join("")}function he(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}let me={"Content-Type":"application/json",Accept:"application/json"};const ge=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),s=0;s<a.length;s++){var r=a[s].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}("csrftoken");ge&&(me["X-CSRFToken"]=ge);const be=_.create({headers:me,paramsSerializer:e=>C.stringify(e,{arrayFormat:"comma"})});be.interceptors.response.use((e=>{var t,a;return!1===(null==(a=null==(t=e.data)?void 0:t.form)?void 0:a.is_valid)?Promise.reject(e.data.form.errors):e}));var fe,we,ye,ve,ke,_e,Ce={namespaced:!0,state:n({},store_bootstrap.user),getters:{},actions:{signup:(e,t)=>be.post("/sign-up/",t,{headers:{"Content-Type":"multipart/form-data"}}),update:({commit:e},t)=>be.post("/user/account/",t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{e("update",t.data.form.data)})),login:(e,t)=>be.post("/user/login/",t,{headers:{"Content-Type":"multipart/form-data"}}),logout:({commit:e})=>be.post("/user/logout/",{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{e("logout")})),resetPassword:(e,t)=>be.post("/user/password_reset/",t,{headers:{"Content-Type":"multipart/form-data"}}),changePassword:(e,t)=>be.post("/user/password_change/",t,{headers:{"Content-Type":"multipart/form-data"}}),resetToken:({commit:e})=>be.post("/user/token_reset/").then((t=>{e("updateToken",t.data.token)}))},mutations:{update:(e,t)=>Object.assign(e,t),updateToken:(e,t)=>e.auth_token.key=t,logout:e=>e.is_authenticated=!1}};(we=fe||(fe={}))[we.Pending=0]="Pending",we[we.InProgress=1]="InProgress",(ve=ye||(ye={}))[ve.Invalid=0]="Invalid",ve[ve.Failed=1]="Failed",(_e=ke||(ke={}))[_e.Completed=0]="Completed";const Te=e=>t=>(a,s)=>{if(t){const e=a;a=s,s=e}return a[e]<s[e]?-1:a[e]>s[e]?1:a.id<s.id?-1:a.id>s.id?1:0},Le={url:e=>{const t=Te("url")(e);return(e,a)=>t(n(n({},e),{url:e.validated_url||e.requested_url}),n(n({},a),{url:a.validated_url||a.requested_url}))},created_at:e=>{const t=Te("created_at")(e);return(e,a)=>t(n(n({},e),{created_at:new Date(e.created_at)}),n(n({},a),{created_at:new Date(a.created_at)}))}};var xe=T({modules:{globals:ue,user:Ce,captures:{namespaced:!0,state:{all:[],apiContext:{count:null,next:null,previous:null}},getters:{getByProperties:e=>t=>e.all.find((e=>Object.keys(t).reduce(((a,s)=>a&&t[s]==e[s]),!0))),sortedBy:e=>(t,a=!0)=>e.all.sort((Le[t]||Te(t))(a)),processing:e=>e.all.filter((e=>pe(e.status)in fe))},actions:{list:({commit:e},t={ordering:"-created_at",limit:10})=>be.get("/captures/",{params:t}).then((t=>{e("updateApiContext",t.data),e("replace",t.data.results)})),pageForward:({commit:e,state:t})=>be.get(t.apiContext.next).then((t=>{e("updateApiContext",t.data),e("append",t.data.results)})),create:({commit:e},t)=>be.post("/captures/",t).then((t=>{e("append",t.data)})),read:({commit:e,getters:t},a)=>be.get(`/captures/${a.id}`).then((s=>{const r=t.getByProperties({id:a.id});r?e("update",{obj:r,vals:s.data}):e("append",[s.data])})),batchRead:({commit:e,getters:t},a)=>be.get("/captures/",{params:{id__in:a.map((({id:e})=>e))}}).then((s=>{for(const[r,n]of s.data.results.entries()){const s=t.getByProperties({id:a[r].id});s?e("update",{obj:s,vals:n}):e("append",[n])}})),eagerCreateAndUpdate:({commit:e,getters:t},a)=>{e("append",a),be.post("/captures/",a).then((s=>{for(const[r,n]of s.data.entries())e("update",{obj:t.getByProperties({created_at:a[r].created_at}),vals:n})}))}},mutations:{updateApiContext:(e,t)=>{return Object.assign(e.apiContext,(a=Object.keys(e.apiContext),s=t,a.reduce(((e,t)=>(e[t]=s[t],e)),{})));var a,s},replace:(e,t)=>e.all=t,append:(e,t)=>e.all.push(...t),update:(e,t)=>Object.assign(t.obj,t.vals),destroy:(e,t)=>e.all.splice(e.all.indexOf(t),1)}}},state:{displayedCapture:void 0,breakpoints:{xs:575,sm:767,md:991,lg:1199,xl:1399},windowWidth:"xl",viewportHeight:0},mutations:{setDisplayedCapture:(e,t)=>{e.displayedCapture=t},setWindowWidth:e=>{window.innerWidth<=e.breakpoints.xs?e.windowWidth="xs":window.innerWidth<=e.breakpoints.sm?e.windowWidth="sm":window.innerWidth<=e.breakpoints.md?e.windowWidth="md":window.innerWidth<=e.breakpoints.lg?e.windowWidth="lg":e.windowWidth="xl"},setViewportHeight:e=>{e.viewportHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},actions:{},getters:{displayedCapture:e=>e.displayedCapture,isMobile:e=>"md"===e.windowWidth||"sm"===e.windowWidth||"xs"===e.windowWidth,isSmallestScreen:e=>"xs"===e.windowWidth,viewportHeight:e=>e.viewportHeight}});const{mapActions:Ae}=o("captures");var Ue={data:()=>({requested_urls:"",capture_oembed_view:!1,label:""}),computed:{formatted_urls(){return this.requested_urls.trim().split("\n")}},methods:n(n({},Ae(["eagerCreateAndUpdate"])),{submit(){this.eagerCreateAndUpdate(this.formatted_urls.map((e=>({requested_url:e,capture_oembed_view:this.capture_oembed_view,label:this.label,created_at:(new Date).toISOString()})))),this.$refs.form.reset()}})};const Se={class:"form-content"},Pe=p("h1",null,"Create a capture for download",-1),Ee=p("h2",{class:"subtitle"},"Enter one or more URLs to capture it in a downloadable archive.",-1),je={class:"mb-3"},Ie={class:"mb-3"},De=p("div",{class:"form-submit-container"},[p("button",{type:"submit",class:"btn btn-primary btn-create"},"Create"),p("span",{class:"warning-text"},[w("Captures expire "),p("u",null,"four hours"),w(" after creation.")])],-1);Ue.render=function(e,t,a,s,r,n){return c(),u("form",{ref:"form",class:"capture-form",onSubmit:t[3]||(t[3]=b(((...e)=>n.submit&&n.submit(...e)),["prevent"])),onKeydown:[t[4]||(t[4]=A(b(((...e)=>n.submit&&n.submit(...e)),["shift","exact","prevent"]),["enter"])),t[5]||(t[5]=A(b(((...e)=>n.submit&&n.submit(...e)),["meta","exact","prevent"]),["enter"]))]},[p("div",Se,[Pe,Ee,p("div",je,[L(p("textarea",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.requested_urls=t),id:"requested_urls",class:"form-control",rows:"3",required:"",placeholder:"Enter one or more URLs on each line","aria-label":"Enter one or more URLs on each line"},null,512),[[x,e.requested_urls]])]),p("div",Ie,[L(p("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.label=t),"aria-label":"Label (Optional)",placeholder:"Label (Optional)",id:"label",type:"text",class:"form-control"},null,512),[[x,e.label]])]),De])],544)};const Fe={name:"CaptureDetail",computed:{downloadUrl(){return this.displayedCapture.archive?this.displayedCapture.archive.download_url:null},size(){return this.displayedCapture.archive?Number((this.displayedCapture.archive.warc_size/1048576).toFixed(2)):0},expiresAt(){return this.displayedCapture.archive?new Date(this.displayedCapture.archive.download_expiration_timestamp):null},succeeded(){return pe(this.displayedCapture.status||"pending")in ke},isMobile(){return this.$store.getters.isMobile},displayedCapture(){return this.$store.getters.displayedCapture}},methods:{getDate:e=>he(e)}},Re={key:0,class:"capture-detail-container"},ze={key:0,class:"data-group"},We=p("br",null,null,-1),He={key:0},Me={key:1},$e={key:1,class:"data-group download-button-group"},Be={class:"float-end"},Oe={class:"data-group"},qe=p("h3",{class:"h6"},"Requested URL",-1),Ve={key:2,class:"data-group"},Ne=p("h3",{class:"h6"},"Labels",-1),Ze={key:3,class:"data-group"},Ge=p("h3",{class:"h6"},"Error Message",-1),Ke={class:"contextItem"},Xe={class:"alert alert-danger"},Ye={key:4,class:"data-group"},Je=p("h3",{class:"h6"},"Preview",-1),Qe={class:"iframe-container"},et={key:5,class:"data-group"},tt=p("h3",{class:"h6"},"Capture size",-1);Fe.render=function(e,t,a,s,r,n){return n.displayedCapture?(c(),u("div",Re,[n.isMobile?(c(),u("div",ze,[p("span",null,"Submitted "+h(n.getDate(n.displayedCapture.created_at)),1),We,n.downloadUrl?(c(),u("span",He,"Expires "+h(n.getDate(n.expiresAt)),1)):n.succeeded?(c(),u("span",Me,"Expired "+h(n.getDate(n.expiresAt)),1)):g("",!0)])):(c(),u("div",$e,[p("span",Be,[n.downloadUrl?(c(),u("a",{key:0,class:"btn bi bi-download download-button",href:n.downloadUrl},null,8,["href"])):g("",!0)])])),p("div",Oe,[qe,p("a",{href:n.displayedCapture.validated_url},h(n.displayedCapture.requested_url),9,["href"])]),n.displayedCapture.label?(c(),u("div",Ve,[Ne,p("p",null,h(n.displayedCapture.label),1)])):g("",!0),n.displayedCapture.message?(c(),u("div",Ze,[Ge,p("div",Ke,[p("div",Xe,h(n.displayedCapture.message),1)])])):g("",!0),n.downloadUrl?(c(),u("div",Ye,[Je,p("div",Qe,[p("replay-web-page",{source:n.downloadUrl,url:n.displayedCapture.validated_url,replaybase:"/replay/",class:"replay contextItem"},null,8,["source","url"])])])):g("",!0),n.size?(c(),u("div",et,[tt,p("p",null,h(n.size)+"MB",1)])):g("",!0)])):g("",!0)};const{mapActions:at}=o("captures");var st={components:{CaptureDetail:Fe},props:["capture"],data:()=>({displayDetails:!1}),computed:{statusOrDefault(){return pe(this.capture.status||"pending")},isProcessing(){return this.statusOrDefault in fe},succeeded(){return this.statusOrDefault in ke},title(){let e;switch(this.statusOrDefault){case"Invalid":e="Invalid URL";break;case"InProgress":e="Capture In Progress";break;case"Failed":e="Capture Failed";break;case"Completed":e="Lorem Ipsum title";break;default:e="Capture Pending"}return e},url(){return this.capture.validated_url||this.capture.requested_url},downloadUrl(){return this.capture.archive?this.capture.archive.download_url:null},expiresAt(){return this.capture.archive?new Date(this.capture.archive.download_expiration_timestamp):null},isMobile(){return this.$store.getters.isMobile}},watch:{"$store.getters.displayedCapture":function(e){e&&e.id===this.capture.id||(this.displayDetails=!1)}},methods:n(n({},at(["read"])),{toggleCaptureDetails(e){this.displayDetails=!this.displayDetails,this.displayDetails?xe.commit("setDisplayedCapture",e):xe.commit("setDisplayedCapture",void 0)},getDate:e=>he(e),shortenUrl:e=>e.length<=100?e:e.slice(0,100)+"..."})};const rt={class:"content"},nt=p("div",{class:"favicon","aria-hidden":"true"},"🔗",-1),ot={class:"h6 capture-title"},it={class:"btn-group spinner"},lt={key:0,class:"status-icon spinner spinner-border spinner-border-sm","aria-hidden":"true"},dt={key:1,class:"btn bi bi-download download-button placeholder"},ct={key:1,class:"capture-url"},ut={class:"secondary-text recorded-date"},pt=w("  "),ht={key:0,class:"warning-text expired-date"},mt={key:1,class:"expired-date"};st.render=function(e,t,a,s,r,n){const o=d("capture-detail");return c(),u("li",{class:[{active:n.isProcessing||n.downloadUrl,"details-shown":e.displayDetails},"capture-list-item"]},[p("div",rt,[nt,p("h3",ot,h(n.title),1),p("div",it,[n.isProcessing?(c(),u("span",lt)):(c(),u(m,{key:1},[n.downloadUrl?(c(),u("a",{key:0,class:"btn bi bi-download download-button",href:n.downloadUrl},null,8,["href"])):(c(),u("span",dt)),p("button",{class:["btn bi bi-chevron-right replay-toggle",{active:e.displayDetails}],onClick:t[1]||(t[1]=e=>n.toggleCaptureDetails(a.capture))},null,2)],64))]),"Invalid"===n.statusOrDefault?(c(),u("span",{key:0,class:"capture-url",textContent:h(n.shortenUrl(n.url))},null,8,["textContent"])):(c(),u("span",ct,[p("a",{href:n.url,textContent:h(n.shortenUrl(n.url))},null,8,["href","textContent"])])),p("span",ut,"Submitted "+h(n.getDate(a.capture.created_at)),1),pt,n.isProcessing?g("",!0):(c(),u(m,{key:2},[n.downloadUrl?(c(),u("span",ht,"Expires "+h(n.getDate(n.expiresAt)),1)):n.succeeded?(c(),u("span",mt,"Expired "+h(n.getDate(n.expiresAt)),1)):g("",!0)],64)),n.isMobile&&e.displayDetails&&a.capture.id===e.$store.getters.displayedCapture.id?(c(),u(o,{key:3})):g("",!0)])],2)};const{mapGetters:gt,mapActions:bt,mapState:ft}=o("captures");var wt={poller:null,components:{CaptureListItem:st},data:()=>({loading:!0,sortBy:"created_at",sortDesc:!0,headings:{status:"Status",url:"URL",label:"Label",capture_oembed_view:"Embedded Version",created_at:"Created At"},scrollable:!1,scrolled:!1}),computed:n(n(n({},gt({processing:"processing",captures:"sortedBy"})),ft({apiContext:"apiContext"})),{apiParams(){return{ordering:(this.sortDesc?"-":"")+this.sortBy}}}),methods:n(n({},bt(["list","pageForward","batchRead"])),{pollForProcessingChanges(){this.$options.poller=setInterval((()=>{this.batchRead(this.processing)}),3e3)},clearProcessingPoll(){clearInterval(this.$options.poller)},clearLazyLoadListeners(){this.$refs.captureList.removeEventListener("scroll",this.handleLazyLoad),window.removeEventListener("scroll",this.handleLazyLoad)},handleLazyLoad(e){let t=this.$refs.captureList,a=this.$store.getters.isSmallestScreen&&t.getBoundingClientRect().bottom<window.innerHeight,s=!this.$store.getters.isSmallestScreen&&t.scrollHeight-Math.abs(t.scrollTop)===t.clientHeight;(a||s)&&(this.clearLazyLoadListeners(),this.loading=!0,this.pageForward().then((()=>this.loading=!1)))},checkIsScrollable(){this.$nextTick((function(){!this.$store.getters.isSmallestScreen&&this.$refs.captureList.scrollHeight>=.8*this.$store.getters.viewportHeight?this.scrollable=!0:this.scrollable=!1}))},applyScrollStyles(e){e.target.scrollTop>0?this.scrolled=!0:this.scrolled=!1},changeSort(e){this.sortBy==e?this.sortDesc=!this.sortDesc:(this.sortBy=e,this.sortDesc=!0)}}),watch:{apiParams:{deep:!0,handler(){this.list(this.apiParams)}},apiContext:{deep:!0,handler(e,t){e.next?(this.$refs.captureList.addEventListener("scroll",this.handleLazyLoad),window.addEventListener("scroll",this.handleLazyLoad)):this.clearLazyLoadListeners()}},processing(e,t){this.$options.poller?e.length||this.clearProcessingPoll():e.length&&this.pollForProcessingChanges()}},created(){this.list().then((()=>this.loading=!1))},mounted(){this.$nextTick((function(){window.addEventListener("resize",this.checkIsScrollable)}))},updated(){this.$nextTick((function(){this.checkIsScrollable()}))},beforeUnmount(){this.clearProcessingPoll(),this.clearLazyLoadListeners(),window.removeEventListener("resize",this.checkIsScrollable)}};const yt=f();i("data-v-6a239cbc");const vt={class:"captures-list"},kt=p("header",{class:"captures-header"},[p("h2",{class:"list-title"},"Capture history")],-1),_t={key:0,class:"capture-list-loading"};l();const Ct=yt(((e,t,a,s,r,n)=>{const o=d("CaptureListItem");return c(),u("div",vt,[kt,p("ul",{ref:"captureList",class:{scrollable:e.scrollable,scrolled:e.scrolled},onScroll:t[1]||(t[1]=(...e)=>n.applyScrollStyles&&n.applyScrollStyles(...e))},[(c(!0),u(m,null,U(e.captures(e.sortBy,e.sortDesc),(e=>(c(),u(o,{key:e.id,capture:e},null,8,["capture"])))),128)),e.loading?(c(),u("li",_t,"Loading...")):g("",!0)],34)])}));wt.render=Ct,wt.__scopeId="data-v-6a239cbc";var Tt={components:{CaptureForm:Ue,CaptureList:wt,CaptureDetail:Fe},computed:{isMobile(){return this.$store.getters.isMobile},displayedCapture(){return this.$store.getters.displayedCapture}},mounted(){this.$store.commit("setWindowWidth"),this.$store.commit("setViewportHeight"),this.$nextTick((()=>{window.addEventListener("resize",function(e,t=500){let a;return()=>{let s=arguments;clearTimeout(a),a=setTimeout((()=>{e.apply(this,s)}),t)}}((()=>{this.$store.commit("setWindowWidth"),this.$store.commit("setViewportHeight")}),250))}));const e=document.createElement("script");e.setAttribute("src","https://cdn.jsdelivr.net/npm/replaywebpage@1.3.9/ui.js"),document.head.appendChild(e)}};Tt.render=function(e,t,a,s,r,n){const o=d("CaptureForm"),i=d("CaptureList"),l=d("capture-detail");return c(),u("div",{class:["capture-dashboard container",{"capture-detail":!e.$store.getters.isMobile&&n.displayedCapture}]},[p(o),p(i),n.isMobile?g("",!0):(c(),u(l,{key:0}))],2)};const{mapState:Lt}=o("user");var xt={components:{TheDashboard:Tt},computed:Lt(["is_authenticated"]),beforeMount(){this.is_authenticated||this.$router.push({name:"login"})}};const At={class:"container-full root-page-container"};xt.render=function(e,t,a,s,r,n){const o=d("TheDashboard");return c(),u("div",At,[e.is_authenticated?(c(),u(o,{key:0})):g("",!0)])};var Ut={props:{head:{type:String},subhead:{type:String},center:{type:Boolean,default:!0}}};const St=f()(((e,t,a,s,r,n)=>(c(),u(m,null,[p("h1",{class:[{"text-center":a.center},"main-header"]},h(a.head),3),a.subhead?(c(),u("p",{key:0,class:[{"text-center":a.center},"main-subheader"]},h(a.subhead),3)):g("",!0)],64))));Ut.render=St,Ut.__scopeId="data-v-aac6d7cc";var Pt={components:{TheMainHeader:Ut},data:()=>({rwp_base_url:"",sw_path:"",auth_token_key:"your-api-key"}),computed:{base_url:()=>window.location.origin}};const Et={class:"container-full docs-page-container"},jt={class:"docs container"},It=v('<ul class="table-of-contents"><li><a href="#capturing-urls">Capturing URLs</a><ul><li><a href="#capturing-ui">Using the Web Interface</a></li><li><a href="#capturing-api">Using the API</a><ul><li><a href="#capturing-auth">Authorization</a></li><li><a href="#capturing-endpoints">Endpoints</a></li></ul></li><li><a href="#capturing-advanced-features">Advanced Features</a><ul><li><a href="#capturing-oembed">oEmbed Captures</a></li><li><a href="#webhook-notifications">Webhooks</a></li><li><a href="#zapier-integration">Zapier Integration</a></li></ul></li><li><a href="#capturing-under-development">Features in Development</a><ul><li>Archive Hashes</li></ul></li></ul></li><li><a href="#viewing-captured-urls">Viewing Captured URLs</a><ul><li><a href="#embed-instructions">How to Embed</a></li><li><a href="#embed-examples">Examples</a><ul><li>Glitch</li></ul></li></ul></li></ul>',1),Dt={class:"content"},Ft=p("p",{class:"lead"},[w("The Perma.cc capture system is built on "),p("a",{href:"https://github.com/webrecorder"},"Webrecorder"),w(" technology and uses an automated browser to produce high-fidelity web archives.")],-1),Rt=p("p",null,[w("A "),p("a",{href:"https://github.com/webrecorder/wacz-format"},"web archive file"),w(' is created for each submitted URL, and each archive can be downloaded, embedded in a web page and displayed ("replayed") by any '),p("a",{href:"https://caniuse.com/serviceworkers"},"modern browser"),w(".")],-1),zt=p("h2",{id:"capturing-urls"},"Capturing URLs",-1),Wt=p("h3",{id:"capturing-ui"},"Using the Web Interface",-1),Ht=w("After logging in, simply "),Mt=w("enter the URLs"),$t=w(' you\'d like to preserve and click "Capture." A capture job will be launched for each submitted URL. '),Bt=p("p",null,[w("A list of all your active capture jobs will appear beneath the form. When each job is finished, you can click "),p("img",{style:{width:"1.5em",height:"1.5em","vertical-align":"top"},alt:"the preview button",title:"Preview Capture",src:"/static/vite/preview.e6fb6c31.svg"}),w(" to preview the capture, and "),p("img",{style:{width:"1.1em",height:"1.1em"},alt:"the download button",title:"Download Capture",src:"/static/vite/download.8d047fcf.svg"}),w(" to download the web archive file.")],-1),Ot=p("p",null,[p("img",{style:{"max-width":"100%"},src:"/static/vite/dashboard-screenshot.fe6ece90.png",alt:"Screenshot of the dashboard. The 'create a new archive' form is above a list of 2 capture jobs, with their download and preview buttons circled."})],-1),qt=p("p",null,"Capture jobs are retained for 4 hours and then are automatically deleted. Deleted capture jobs cannot be recovered from the service.",-1),Vt=p("p",null,[w("Read more about other options under "),p("a",{href:"#capturing-advanced-features"},"advanced features"),w(" and "),p("a",{href:"#capturing-under-development"},"features in development"),w(".")],-1),Nt=p("h3",{id:"capturing-api"},"Using the API",-1),Zt={key:0},Gt=w("Your API Key is "),Kt=p("h4",{id:"capturing-auth"},"Authorization ",-1),Xt=w("All registered users receive an "),Yt=w("API key"),Jt=w(" . Every request to the API must be authenticated by providing that key as part of the "),Qt=p("code",null,"Authorization",-1),ea=w(" header: "),ta=p("h4",{id:"capturing-endpoints"},"Endpoints",-1),aa=w("You can create archives programmatically by sending an HTTP "),sa=p("code",null,"POST",-1),ra=w(" to "),na=w("."),oa=p("p",null,[w("Required data (JSON-formatted): "),p("code",null,'"urls"'),w(" (a list of URLs to capture, each explicitly prefixed by "),p("code",null,"http"),w(" or "),p("code",null,"https"),w(").")],-1),ia=p("p",null,[w("Optionally, you may also specify a "),p("code",null,'"tag"'),w(" (a nickname for this batch of URLs, for your convenience). If you are subscribed to "),p("a",{href:"#webhook-notifications"},"webhook notifications"),w(", you may also optionally specify a "),p("code",null,'"userDataField"'),w(" for your convenience (a string you would like included, verbatim, in the webhook notification response).")],-1),la=p("p",null,[w("Here's a request to archive a small batch of two URLs using "),p("code",null,"curl"),w(":")],-1),da=p("p",null,"The response, on success, will be a JSON dictionary including a jobid for each submitted URL:",-1),ca=p("pre",null,[p("code",null,'{"urls": 2, "jobids": ["uuid4-1", "uuid4-2"]}')],-1),ua=w("You can then query "),pa=w(" to see all the capture jobs you have in the system:"),ha=p("p",null,"Sample Response:",-1),ma=p("pre",null,[p("code",null,'{\n        "jobs": [{\n        "jobid": "uuid4-1",\n        "userid": "3",\n        "captureUrl": "https://twitter.com/permacc",\n        "useEmbeds": false,\n        "userTag": "my-batch",\n        "startTime": "2020-09-28T23:54:19+00:00",\n        "elapsedTime": "2020-09-28T23:56:45+00:00",\n        "accessUrl": null,\n        "status": "In progress"\n        }, {\n        "jobid": "uuid4-2",\n        "userid": "3",\n        "captureUrl": "https://example.com/",\n        "useEmbeds": false,\n        "userTag": "my-batch",\n        "startTime": "2020-09-28T23:54:19+00:00",\n        "elapsedTime": "2020-09-28T23:54:39+00:00",\n        "status": "Complete",\n        "accessUrl": "https://permacaptures.example.com/path/to/download/mycapture.wacz"\n        }]\n        }\n    ')],-1),ga=p("p",null,[w("The response will list all active capture jobs created by your account. Each job will have a "),p("code",null,'"status"'),w(" field, set to either "),p("code",null,"In progress"),w(", "),p("code",null,"Failed"),w(", or "),p("code",null,"Complete"),w(".")],-1),ba=p("p",null,[w("A job that is "),p("code",null,"In progress"),w(" should be monitored until it is "),p("code",null,"Complete"),w(". (Or, if you'd like to be notified when a job is complete, check out "),p("a",{href:"#webhook-notifications"},"webhook notifications"),w(".) A "),p("code",null,"Failed"),w(" job indicates a permanent failure to produce a capture: you may wish to retry.")],-1),fa=p("p",null,[w("A job that is "),p("code",null,"Complete"),w(" will have an "),p("code",null,"accessUrl"),w(" set to a downloadable URL. The download URL is valid for 4 hours after the job is completed.")],-1),wa=p("p",null,[w("All information about a capture job is automatically deleted after 4 hours. (Learn more about the "),p("a",{href:"#archive-hashes"},"information we retain"),w(".)")],-1),ya=p("p",null,[w("Read more about other options under "),p("a",{href:"#capturing-advanced-features"},"advanced features"),w(" and "),p("a",{href:"#capturing-under-development"},"features in development"),w(".")],-1),va=p("h3",{id:"capturing-advanced-features"},"Advanced Features",-1),ka=p("h4",{id:"capturing-oembed"},'Capture of "Embeddable" Views',-1),_a=p("p",null,[w('Many websites offer an easily-embeddable "'),p("a",{href:"https://oembed.com/"},"oEmbed"),w('" view of snippets of their content. For example, Twitter provides the following embeddable view of the Tweet at '),p("a",{href:"https://twitter.com/permacc/status/1039225277119954944"},"https://twitter.com/permacc/status/1039225277119954944"),w(": ")],-1),Ca=p("blockquote",{class:"twitter-tweet"},[p("p",{lang:"en",dir:"ltr"},[w("Are you someone who cites to the internet a lot? The web's a wonderful resource but can be more fragile than you think. Anyone working in "),p("a",{href:"https://twitter.com/hashtag/academia?src=hash&ref_src=twsrc%5Etfw"},"#academia"),w(", "),p("a",{href:"https://twitter.com/hashtag/journalism?src=hash&ref_src=twsrc%5Etfw"},"#journalism"),w(", "),p("a",{href:"https://twitter.com/hashtag/legaltech?src=hash&ref_src=twsrc%5Etfw"},"#legaltech"),w("- any industry that depends on reliable citations should be on the offense against "),p("a",{href:"https://twitter.com/hashtag/linkrot?src=hash&ref_src=twsrc%5Etfw"},"#linkrot"),w(", Perma can help! "),p("a",{href:"https://t.co/XVwEwa2zEA"},"pic.twitter.com/XVwEwa2zEA")]),w("— Perma.cc (@permacc) "),p("a",{href:"https://twitter.com/permacc/status/1039225277119954944?ref_src=twsrc%5Etfw"},"September 10, 2018")],-1),Ta=p("p",null,'When submitting URLs for capture, you may indicate that when a target website provides support for an "oEmbed" view, the web archive should include a capture of that view, along with the standard web view.',-1),La=p("p",null,[w('Using the web interface: check the "Archive Embedded Version" box. Using the API: include '),p("code",null,'"embeds": true'),w(" in your "),p("code",null,"POST"),w(" data.")],-1),xa=p("p",null,[w("Capture via oEmbed is currently supported for Twitter, Instagram, Facebook, YouTube, and SlideShare. Additional domains may be supported in the future; an up-to-date list of "),p("a",{href:"https://github.com/ikreymer/permafact-backend/blob/master/driver/embeds.json"},"supported domains and URL patterns"),w(" is available on Github.")],-1),Aa=p("h4",{id:"webhook-notifications"},"Webhook Notifications",-1),Ua=p("p",null,[w("We can notify you when your capture jobs are complete by sending an HTTP "),p("code",null,"POST"),w("to a callback URL you specify.")],-1),Sa=w("To subscribe to the "),Pa=p("code",null,"ARCHIVE_CREATED",-1),Ea=w(" event, "),ja=p("code",null,"POST",-1),Ia=w(" your callback URL to "),Da={href:"/webhooks/"},Fa=w("."),Ra=p("p",null,[w("We'll send back a subscription "),p("code",null,"id"),w(", as well as a "),p("code",null,"signingKey"),w(" and "),p("code",null,"signingKeyAlgorithm"),w(" that you can optionally use to verify that any "),p("code",null,"POST"),w(" received by your callback URL is really from us.")],-1),za=p("pre",null,[p("code",null,'{\n        "id": 53,\n        "user": 3,\n        "eventType": "ARCHIVE_CREATED",\n        "signingKey": "a-128-character-key"\n        "signingKeyAlgorithm": "sha256"\n        }\n    ')],-1),Wa=p("p",null,"You can subscribe as many times as you like, if you'd like multiple callback URLs to be notified.",-1),Ha=p("p",null,[w("When an archive you request is complete, we'll make a "),p("code",null,"POST"),w(" to your callback like the following: ")],-1),Ma=p("pre",null,[p("code",null,'{\n        "userid": 3,\n        "jobid": "uuid4-1",\n        "url": "http://cnn.com",\n        "accessUrl": "https://permacaptures.example.com/path/to/download/mycapture.wacz",\n        "userDataField": ""\n        }\n    ')],-1),$a=p("p",null,[w("We will include the signature in the "),p("code",null,"X-Hook-Signature"),w(" header.")],-1),Ba=p("p",null,"If you want to verify the signature before acting, here's how to do it in Python:",-1),Oa=p("pre",null,[p("code",null,"import hmac\n        import urllib\n        def is_valid_signature(signature, data, signing_key, signing_key_algorithm):\n        return hmac.compare_digest(\n        signature,\n        hmac.new(\n        bytes(signing_key, 'utf-8'),\n        bytes(urllib.parse.urlencode(data, doseq=True), 'utf-8'),\n        signing_key_algorithm\n        ).hexdigest()\n        )\n    ")],-1),qa=p("p",null,"...and JavaScript:",-1),Va=p("pre",null,[p("code",null,"const crypto = require('crypto');\n        const querystring = require('querystring');\n        function isValidSignature(signature, data, signingKey, signingKeyAlgorithm){\n        const postedSignature = Buffer.from(signature, 'utf-8');\n        const generatedSignature = Buffer.from(\n        crypto\n        .createHmac(signingKeyAlgorithm, signingKey)\n        .update(querystring.stringify(data))\n        .digest('hex'),\n        'utf-8'\n        );\n        try {\n        return crypto.timingSafeEqual(postedSignature, generatedSignature);\n        } catch (e) {\n        return false;\n        }\n        }\n    ")],-1),Na=p("p",null,"If you no longer wish to receive notifications, you can delete your subscription:",-1),Za=p("h4",{id:"zapier-integration"},"Zapier Integration",-1),Ga=p("p",null,[p("a",{href:"https://zapier.com"},"Zapier"),w(" users can integrate the Perma.cc capture service in their workflows. ")],-1),Ka=p("p",null,[w("For example, using this Zap, you can "),p("a",{href:"https://zapier.com/shared/3ee9336c0d9734d9fe6cc86e672b530f8336e93b"},"archive a URL straight from Slack"),w(", and this Zap will follow up, posting a "),p("a",{href:"https://zapier.com/app/editor/108033832/nodes/108033832"},"link to the completed archive as a reply"),w(", when it's finished.")],-1),Xa=p("p",null,[p("img",{style:{"max-width":"100%"},src:"/static/vite/slack-screenshot.46ab25e6.png",alt:"Screenshot of Slack, showing a capture request and a threaded reply with a link to the archive."})],-1),Ya=p("p",null,[w("This Zap, on the other hand, will post to a pre-configured Slack channel of your choice whenever "),p("a",{href:"https://zapier.com/shared/e1ccf1faa9b236b2317b85b46f0a643e8259aa77"},"an archive created by your account is ready to be downloaded"),w(".")],-1),Ja=p("p",null,"Let us know if you are interested in a Zapier integration, and we'll help you get started!",-1),Qa=p("p",null,[w("Note: Zapier does not support "),p("a",{href:"http://resthooks.org/docs/security/"},"signature validation"),w(", instead relying on the privacy of subscription URLs for security. If you need to further verify the authenticity of data triggering your workflows, we recommend working with our webhooks directly.")],-1),es=p("h3",{id:"capturing-under-development"},"Features in Development",-1),ts=p("h4",{id:"archive-hashes"},"Archive Hashes",-1),as=p("p",null,[w("We maintain a "),p("code",null,"sha-256"),w(" hash of every web archive file produced by the service, along with the timestamp of its production and the user id of the requesting user. We don't store any other metadata about capture jobs, including the target URL.")],-1),ss=p("p",null,[w("We selected "),p("code",null,"sha256"),w(", despite its known limitations, because we wanted the algorithm to be "),p("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest"},"supported in JavaScript"),w(", and we weren't sure it was reasonable to expect users attempting to verify file hashes to manually calculate "),p("code",null,"sha512/256"),w(". ")],-1),rs=p("p",null,"Let us know if that sounds correct to you!",-1),ns=p("hr",null,null,-1),os=p("h2",{id:"viewing-captured-urls"},"Viewing Captured URLs",-1),is=p("p",null,[w("The downloadable WACZ files can be embedded in your site using the "),p("a",{href:"https://replayweb.page"},"ReplayWeb.page"),w(" embed system, loaded directly from NPM.")],-1),ls=p("h3",{id:"embed-instructions"},"How to Embed",-1),ds=w("The replay system requires you to host a single JavaScript file on your server, which visitors browsers will use to install the service worker that handles playbacks. We recommend putting it in an empty directory, for example at "),cs=p("code",null,"/replay/sw.js",-1),us=w(". This file must be named "),ps=p("code",null,"sw.js",-1),hs=w(", and it should contain the following: "),ms=w("Each page that will contain embedded archives should include the following script and should also set the height for the "),gs=p("code",null,"replay-web-page",-1),bs=w(" tag to ensure a minimum height. (600px is used as an example here). "),fs=p("li",null,[w("For each web archive/WACZ you'd like to embed, simply add the following HTML snippet: "),p("pre",null,[p("code",null,'<replay-web-page\n            source="https://mysite.example.com/path/to/archives/mycapture.wacz"\n            url="https://example.com/"\n            replayBase="/replay/"\n            />\n      ')])],-1),ws=p("p",null,[w("The "),p("code",null,"source"),w(" attribute should point to the URL of where the WACZ file is hosted, while the "),p("code",null,"url"),w(" is the URL captured. The "),p("code",null,"replayBase"),w(" is the path that contains the "),p("code",null,"sw.js"),w(" file. ("),p("code",null,"/replay/"),w(" in this example is also the default, and therefore could be omitted.)")],-1),ys=p("p",null,"The web server hosting WACZ files must support HTTP/1.1 range requests and be able to read portions of a file. If the WACZ file is hosted on a different domain than your site, CORS rules will also need to be enabled on the hosting server.",-1),vs=p("h3",{id:"embed-examples"},"Examples",-1),ks=p("p",null,"The following two archives were created using this system:",-1),_s=p("ul",null,[p("li",null,[p("a",{href:"https://permafact-demo.s3.amazonaws.com/twitter.com-2020-09-03.wacz"},"https://permafact-demo.s3.amazonaws.com/twitter.com-2020-09-03.wacz")]),p("li",null,[p("a",{href:"https://permafact-demo.s3.amazonaws.com/www.youtube.com-2020-09-03.wacz"},"https://permafact-demo.s3.amazonaws.com/www.youtube.com-2020-09-03.wacz")])],-1),Cs=p("p",null,"We'll embed a replay of the first archive using the following code:",-1),Ts=p("pre",null,[p("code",null,'<replay-web-page\n        source="https://permafact-demo.s3.amazonaws.com/twitter.com-2020-09-03.wacz"\n        url="https://twitter.com/dog_rates/status/1298052245209006086?s=20"\n        ></replay-web-page>\n    ')],-1),Ls=p("replay-web-page",{source:"https://permafact-demo.s3.amazonaws.com/twitter.com-2020-09-03.wacz",url:"https://twitter.com/dog_rates/status/1298052245209006086?s=20",replayBase:"{{ rwp_base_url }}/"},null,-1),xs=w("The service worker is loaded from "),As=w(". Since that's the default path, no further configuration is needed."),Us=p("p",null,"We'll embed a replay of the second archive using the following code:",-1),Ss=p("pre",null,[p("code",null,'<replay-web-page\n        source="https://permafact-demo.s3.amazonaws.com/www.youtube.com-2020-09-03.wacz"\n        url="https://www.youtube.com/watch?v=dIUwVMDI7yE",\n        replayBase="/replay/"\n        ></replay-web-page>\n    ')],-1),Ps=p("replay-web-page",{source:"https://permafact-demo.s3.amazonaws.com/www.youtube.com-2020-09-03.wacz",url:"https://www.youtube.com/watch?v=dIUwVMDI7yE",replayBase:"{{ rwp_base_url }}/"},null,-1),Es=p("p",null,[w("Here, we redundantly configure "),p("code",null,"replayBase"),w(" to point to "),p("code",null,"/replay/"),w(", the path where "),p("code",null,"sw.js"),w(" for demonstration purposes.")],-1),js=p("h4",null,"Glitch",-1),Is=p("p",null,[w("A fully stand-alone example of these embeds is also available on "),p("a",{href:"https://permafact-demo.glitch.me/"},"Glitch"),w(". ")],-1);Pt.render=function(e,t,a,s,r,n){const o=d("TheMainHeader"),i=d("router-link");return c(),u("div",Et,[p("div",jt,[It,p("div",Dt,[p(o,{head:"User Guide",center:!1}),Ft,Rt,zt,Wt,p("p",null,[Ht,p(i,{to:{name:"root"}},{default:y((()=>[Mt])),_:1}),$t]),Bt,Ot,qt,Vt,Nt,e.auth_token_key?(c(),u("p",Zt,[p("em",null,[Gt,p("code",null,h(e.auth_token_key),1)])])):g("",!0),Kt,p("p",null,[Xt,p(i,{to:{name:"account"}},{default:y((()=>[Yt])),_:1}),Jt,Qt,ea]),p("pre",null,[p("code",null,'curl -H "Authorization: Token '+h(e.auth_token_key)+'" '+h(n.base_url)+"...",1)]),ta,p("p",null,[aa,sa,ra,p("code",null,h(n.base_url+"/captures/"),1),na]),oa,ia,la,p("pre",null,[p("code",null,'curl -X POST \\\n        -H "Content-Type: application/json" \\\n        -H "Authorization: Token '+h(e.auth_token_key)+'" \\\n        --data \'{ \\\n        "urls": [ \\\n        "https://twitter.com/permacc", \\\n        "https://example.com/" \\\n        ], \\\n        "tag": "my-batch", \\\n        "userDataField": "foo=bar&boo=baz" \\\n        }\' \\\n        '+h(n.base_url+"/captures/"),1)]),da,ca,p("p",null,[ua,p("code",null,h(n.base_url+"/captures/"),1),pa]),p("pre",null,[p("code",null,'curl -H "Authorization: Token '+h(e.auth_token_key)+'" '+h(n.base_url+"/captures/")+"\n    ",1)]),ha,ma,ga,ba,fa,wa,ya,va,ka,_a,Ca,Ta,La,xa,Aa,Ua,p("p",null,[Sa,Pa,Ea,ja,Ia,p("a",Da,h(n.base_url+"/webhooks/"),1),Fa]),p("pre",null,[p("code",null,'curl -X POST \\\n        -H "Content-Type: application/json" \\\n        -H "Authorization: Token '+h(e.auth_token_key)+'" \\\n        --data \'{ \\\n        "callbackUrl": https://mysite.com/callback", \\\n        "eventType": "ARCHIVE_CREATED"\n        }\' \\\n        '+h(n.base_url+"/webhooks/")+"\n    ",1)]),Ra,za,Wa,Ha,Ma,$a,Ba,Oa,qa,Va,Na,p("pre",null,[p("code",null,'curl -X DELETE -H "Authorization: Token '+h(e.auth_token_key)+'" '+h(n.base_url+"/webhooks/53")+"\n    ",1)]),Za,Ga,Ka,Xa,Ya,Ja,Qa,es,ts,as,ss,rs,ns,os,is,ls,p("ol",null,[p("li",null,[ds,cs,us,ps,hs,p("pre",null,[p("code",null,'importScripts("'+h(e.rwp_base_url)+'/sw.js");\n      ',1)])]),p("li",null,[ms,gs,bs,p("pre",null,[p("code",null,'<script src="'+h(e.rwp_base_url)+'/ui.js"><\/script>\n            <style>\n            replay-web-page {\n            height: 600px;\n            display: flex;\n            }\n            </style>\n      ',1)])]),fs]),ws,ys,vs,ks,_s,Cs,Ts,Ls,p("p",null,[xs,p("a",{href:e.sw_path},[p("code",null,h(e.sw_path),1)],8,["href"]),As]),Us,Ss,Ps,Es,js,Is])])])};const{mapActions:Ds}=o("user");var Fs={props:{fields:Array,submitText:{type:String,default:"Submit"},action:Function,title:String},data:()=>({processing:!1,displayValidations:!1,errors:{}}),computed:{fieldsWithDefaults(){return this.fields.map((e=>n({label:e.name.split("_").map(((e,t)=>t?e:e.charAt(0).toUpperCase()+e.slice(1))).join(" "),id:e.name+Date.now(),type:"text",readonly:!1,disabled:!1,required:!0},e)))},errorCount(){return Object.keys(this.errors).length}},watch:{errorCount(e){e&&this.displayValidations&&this.$nextTick((()=>this.$refs.errorsHeader.focus()))}},methods:n(n({},Ds(["changePassword"])),{getFieldByName(e){return this.fieldsWithDefaults.find((t=>t.name==e))},checkValidity(e){e.target.checkValidity()&&delete this.errors[e.target.name]},onInvalid(e){this.errors[e.target.name]=[{message:e.target.validationMessage}]},collectFrontendErrors(){this.errors={},this.$el.querySelectorAll(":invalid").forEach((e=>this.errors[e.name]=[{message:e.validationMessage}]))},submit(e){this.collectFrontendErrors(),this.displayValidations=!0,0==this.errorCount&&(this.processing=!0,this.action(new FormData(e.target)).then((()=>this.displayValidations=!1)).catch((e=>this.errors=e)).then((()=>this.processing=!1)))}})};const Rs=f();i("data-v-a1cb8fb2");const zs={key:0},Ws={key:1,ref:"errorsHeader",tabindex:"-1",class:"invalid-feedback d-block"},Hs=w(" Please correct the following "),Ms=w("error"),$s={key:1},Bs=w(": "),Os=w(": "),qs={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};l();const Vs=Rs(((e,t,a,s,r,n)=>(c(),u("form",{class:"base-form",onSubmit:t[3]||(t[3]=b(((...e)=>n.submit&&n.submit(...e)),["prevent"])),novalidate:""},[a.title?(c(),u("h1",zs,h(a.title),1)):g("",!0),e.displayValidations&&n.errorCount?(c(),u("div",Ws,[Hs,1==n.errorCount?(c(),u(m,{key:0},[Ms],64)):(c(),u("strong",$s,h(n.errorCount)+" errors",1)),Bs,p("ul",null,[(c(!0),u(m,null,U(e.errors,((e,t)=>(c(),u("li",null,["__all__"!=t?(c(),u(m,{key:0},[p("a",{href:"#"+n.getFieldByName(t).id},h(n.getFieldByName(t).label),9,["href"]),Os],64)):g("",!0),w(" "+h(e.map((({message:e})=>e)).join(", ")),1)])))),256))])],512)):g("",!0),(c(!0),u(m,null,U(n.fieldsWithDefaults,(a=>(c(),u(m,null,[p("label",{for:a.id,class:"form-label mt-3"},h(a.label),9,["for"]),L(p("input",{"onUpdate:modelValue":e=>a.value=e,onBlur:t[1]||(t[1]=(...e)=>n.checkValidity&&n.checkValidity(...e)),onInvalid:t[2]||(t[2]=(...e)=>n.onInvalid&&n.onInvalid(...e)),name:a.name,id:a.id,type:a.type,class:["form-control",{"is-invalid":e.displayValidations&&e.errors[a.name],"is-valid":e.displayValidations&&!e.errors[a.name]}],required:a.required,disabled:!0===a.disabled||e.processing,readonly:a.readonly,"aria-invalid":!!e.errors[a.name],"aria-describedby":(e.errors[a.name]||[]).map(((e,t)=>a.id+"InvalidFeedback"+t))},null,42,["onUpdate:modelValue","name","id","type","required","disabled","readonly","aria-invalid","aria-describedby"]),[[S,a.value]]),(c(!0),u(m,null,U(e.errors[a.name],((e,t)=>(c(),u("div",{id:a.id+"InvalidFeedback"+t,class:"invalid-feedback"},h(e.message),9,["id"])))),256))],64)))),256)),p("button",{type:"submit",class:"btn btn-primary mt-3",disabled:e.processing},[e.processing?(c(),u("span",qs)):g("",!0),w(" "+h(a.submitText),1)],8,["disabled"])],32))));Fs.render=Vs,Fs.__scopeId="data-v-a1cb8fb2";const Ns={name:"WelcomeMessage"},Zs=f();i("data-v-6355e12a");const Gs={class:"message"},Ks=p("h1",{class:"mb-4"},[w(" Websites change."),p("br"),p("span",{class:"blue-text"},"Perma Captures"),w(" don't. ")],-1),Xs=p("span",{class:"h5 subtitle mb-2"},"Perma Captures help scholars, newsrooms, researchers, and others create permanent records of the web.",-1),Ys=p("span",{class:"h5 subtitle d-none d-sm-none d-md-block mb-4"},"Simply create a capture and download it for your records.",-1),Js=p("img",{class:"d-none d-sm-none d-md-block",src:"/static/vite/welcome-graphic.bc1da09f.svg",alt:"Graphic showing that while websites change, Perma Captures don't."},null,-1);l();const Qs=Zs(((e,t,a,s,r,n)=>(c(),u("div",Gs,[Ks,Xs,Ys,Js]))));Ns.render=Qs,Ns.__scopeId="data-v-6355e12a";const{mapState:er}=o("globals"),{mapActions:tr}=o("user");var ar={components:{BaseForm:Fs,WelcomeMessage:Ns},computed:er(["app_name","contact_email","allow_signups"]),data:()=>({fields:[{name:"first_name",label:"First name"},{name:"last_name",label:"Last name"},{name:"email",label:"Email"}]}),methods:n(n({},tr(["signup"])),{signUp(e){return this.signup(e).then((()=>window.location="/"))}})};const sr=f();i("data-v-cba6fa52");const rr={class:"container-full two-col login-page-container"},nr={key:0,class:"enter-container"},or={class:"small"},ir=w(" Have an account? "),lr=w("Log in"),dr={key:1,class:"enter-container"},cr=p("h2",null,"Interested?",-1),ur=w("Just "),pr=w(" how you you'd like to use the service, and we can send you an invitation!"),hr=p("p",null,"(While in beta, we are invitation-only, but we plan to be available for general use soon!)",-1),mr=w("Learn more.");l();const gr=sr(((e,t,a,s,r,n)=>{const o=d("WelcomeMessage"),i=d("BaseForm"),l=d("router-link");return c(),u("div",rr,[p(o),e.allow_signups?(c(),u("div",nr,[p(i,{title:"Sign up",fields:e.fields,submitText:"Sign up",action:n.signUp},null,8,["fields","action"]),p("p",or,[ir,p(l,{to:{name:"login"}},{default:sr((()=>[lr])),_:1})])])):(c(),u("div",dr,[cr,p("p",null,[ur,p("a",{href:`mailto:${e.contact_email}?subject=Request%20A%20Capturing%20Account`},"let us know",8,["href"]),pr]),hr,p("p",null,[p(l,{to:{name:"docs"}},{default:sr((()=>[mr])),_:1})])]))])}));ar.render=gr,ar.__scopeId="data-v-cba6fa52";const{mapActions:br}=o("user");var fr={components:{BaseForm:Fs,WelcomeMessage:Ns},data:()=>({fields:[{name:"username",label:"Email"},{name:"password",type:"password"}]}),methods:n(n({},br(["login"])),{doLogin(e){return this.login(e).then((()=>window.location="/"))}})};const wr={class:"container-full two-col login-page-container"},yr={class:"enter-container"},vr={class:"small"},kr=w(" Don't have an account? "),_r=w("Sign up"),Cr={class:"small"},Tr=w(" Forgot your password? "),Lr=w("Reset password");fr.render=function(e,t,a,s,r,n){const o=d("WelcomeMessage"),i=d("BaseForm"),l=d("router-link");return c(),u("div",wr,[p(o),p("div",yr,[p(i,{title:"Log in",fields:e.fields,submitText:"Log in",action:n.doLogin},null,8,["fields","action"]),p("p",vr,[kr,p(l,{to:{name:"sign_up"}},{default:y((()=>[_r])),_:1})]),p("p",Cr,[Tr,p(l,{to:{name:"password_reset"}},{default:y((()=>[Lr])),_:1})])])])};var xr={components:{TheMainHeader:Ut}};const Ar={class:"container text-center"},Ur=p("div",null,"You have logged out.",-1),Sr=w("Log in again");xr.render=function(e,t,a,s,r,n){const o=d("TheMainHeader"),i=d("router-link");return c(),u(m,null,[p(o,{head:"Logged out"}),p("div",Ar,[Ur,p("div",null,[p(i,{to:{name:"login"}},{default:y((()=>[Sr])),_:1})])])],64)};const{mapActions:Pr}=o("user");var Er={components:{BaseForm:Fs},data:()=>({fields:[{name:"first_name"},{name:"last_name"},{name:"email",type:"email"}]}),methods:n({},Pr(["update"])),created(){for(const e of this.fields)e.value=this.$store.state.user[e.name]}};Er.render=function(e,t,a,s,r,n){const o=d("BaseForm");return c(),u(o,{fields:e.fields,action:e.update},null,8,["fields","action"])};const{mapState:jr,mapActions:Ir}=o("user");var Dr={components:{TheUserForm:Er,BaseForm:Fs},computed:jr(["auth_token"]),methods:n({},Ir(["resetToken"]))};const Fr={class:"container-full two-col account-page-container"},Rr={class:"account-info"},zr=p("h1",null,"Profile",-1),Wr=w(" Change my password "),Hr={class:"api-info"},Mr=p("h1",null,"API",-1);Dr.render=function(e,t,a,s,r,n){const o=d("TheUserForm"),i=d("router-link"),l=d("BaseForm");return c(),u("div",Fr,[p("div",Rr,[zr,p(o),p(i,{to:{name:"password_change"},class:"btn btn-primary mt-3"},{default:y((()=>[Wr])),_:1})]),p("div",Hr,[Mr,p(l,{fields:[{name:"api-key",label:"Your API key",value:e.auth_token.key,readonly:!0}],action:e.resetToken,submitText:"Get a new key"},null,8,["fields","action"])])])};const{mapActions:$r}=o("user");var Br={components:{BaseForm:Fs},data:()=>({fields:[{name:"old_password",type:"password"},{name:"new_password1",label:"New password",type:"password"},{name:"new_password2",label:"New password confirmation",type:"password"}]}),methods:n({},$r(["changePassword"]))};const Or={class:"container-full two-col login-page-container "},qr={class:"enter-container"};Br.render=function(e,t,a,s,r,n){const o=d("BaseForm");return c(),u("div",Or,[p("div",qr,[p(o,{title:"Password change",fields:e.fields,action:e.changePassword},null,8,["fields","action"])])])};const{mapActions:Vr}=o("user");var Nr={components:{TheMainHeader:Ut,BaseForm:Fs},data:()=>({fields:[{name:"email",type:"email"}]}),methods:n({},Vr(["resetPassword"]))};const Zr={class:"container"},Gr={class:"row justify-content-center"};Nr.render=function(e,t,a,s,r,n){const o=d("TheMainHeader"),i=d("BaseForm");return c(),u("div",Zr,[p(o,{head:"Forgot your password?",subhead:"We'll email you instructions for setting a new one."}),p("div",Gr,[p(i,{fields:e.fields,action:e.resetPassword,submitText:"Reset my password",class:"col-lg-4 col-md-7 col-9"},null,8,["fields","action"])])])};const Kr=[{path:"/",name:"root",component:xt},{path:"/docs/",name:"docs",component:Pt},{path:"/sign-up/",name:"sign_up",component:ar},{path:"/user/login/",name:"login",component:fr},{path:"/user/logout/",name:"logout",component:xr},{path:"/user/account/",name:"account",component:Dr},{path:"/user/password_change/",name:"password_change",component:Br},{path:"/user/password_reset/",name:"password_reset",component:Nr}];var Xr=P({history:E(),routes:Kr});const Yr=j(ce);Yr.use(xe),Yr.use(Xr),Yr.mount("#vue-app");
